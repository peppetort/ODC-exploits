from pwn import *
import angr
import claripy

proj = angr.Project('prodkey')

chars = [claripy.BVS('c%d' % i, 8) for i in range(29)]
input_str = claripy.Concat(*chars + [claripy.BVV(b'\n')])
initial_state = proj.factory.entry_state(stdin=input_str)

for c in chars:
	initial_state.solver.add(c >= 0x20, c <= 0x7e)

initial_state.solver.add(chars[5] == '-')
initial_state.solver.add(chars[11] == '-')
initial_state.solver.add(chars[17] == '-')
initial_state.solver.add(chars[23] == '-')

sim = proj.factory.simulation_manager(initial_state)
sim.explore(find=0x400e4e)

if sim.found:
	sol = sim.found[0].posix.dumps(0)
	print(str(sol[:-1]))
	r = remote('training.jinblack.it', 2021)
	
	x = r.recv()
	print(x)
	input('press a key..')
	r.send(sol)
	x = r.recv()
	print(x)

else:
	print('No solution found')
